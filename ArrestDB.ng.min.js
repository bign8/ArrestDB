/*!
 * ArrestDB-js 0.0.0 (https://github.com/bign8/ArrestDB/tree/ng)
 * Author: bign8 (https://github.com/bign8)
 * Licensed under MIT (https://github.com/bign8/ArrestDB/blob/ng/LICENSE)
 */
angular.module("ArrestDB",[]).factory("ArrestDB",["$http",function(a){var b="./",c=function(a){return a.data.hasOwnProperty("error")?[]:a.data},d=function(a){for(var b=0,c=this.list.length;c>b;b++)if(a[this.id]==this.list[b][this.id]){this.list.splice(b,1);break}return a},e=function(a,b){return a[this.id]=b.success.insertID,this.list.push(a),a},f=function(a,b){if(b.hasOwnProperty("success"))for(var c=0;c<this.list.length;c++)if(this.list[c][this.id]==a[this.id]){this.list[c]=a;break}return a},g=function(a){for(var b=0;b<this.callbacks.length;b++)this.callbacks[b].call(this,a);return a},h=function(a,b,c,d){this.list=[],this.callbacks=[],this.table=a,this.id=b||a+"ID",this.all(d).then(angular.extend.bind(void 0,this.list)).then(g.bind(this)).then(c)};return h.left_join=function(a,b){var c=[],d=function(d){if(!a.list.length)return angular.copy([],c);angular.copy(a.list,c);for(var e={},f=0,g=b.list.length;g>f;f++)e[b.list[f][a.id]]=b.list[f];for(var f=0,g=c.length;g>f;f++)angular.extend(c[f],e[c[f][a.id]]||null);return d};return a.add_cb(d),b.add_cb(d),d(),c},h.left_join_many=function(a,b,c){var d=function(d){if(a.list.length&&b.list.length){for(var e={},f=void 0,g=0,h=b.list.length;h>g;g++)f=b.list[g],e.hasOwnProperty(f[a.id])?e[f[a.id]].push(f[c]):e[f[a.id]]=[f[c]];for(var g=0,h=a.list.length;h>g;g++)a.list[g][c]=e[a.list[g][a.id]]||[];return d}};a.add_cb(d),b.add_cb(d),d()},h.prototype={all:function(d){return a.get(b+this.table+(d?d:"")).then(c.bind(this)).then(angular.extend.bind(void 0,this.list)).then(g.bind(this))},get:function(d,e){return a.get(b+this.table+"/"+d+(e?e:"")).then(c.bind(this)).then(g.bind(this))},set:function(d){return a.put(b+this.table+"/"+d[this.id],d).then(c.bind(this)).then(f.bind(this,d)).then(g.bind(this))},rem:function(e){return a.delete(b+this.table+"/"+e[this.id]).then(c.bind(this)).then(d.bind(this,e)).then(g.bind(this))},add:function(d){return a.post(b+this.table,d).then(c.bind(this)).then(e.bind(this,d)).then(g.bind(this))},add_cb:function(a){this.callbacks.push(a)},rem_cb:function(a){var b=this.callbacks.indexOf(a);b>=0&&this.callbacks.splice(b,1)}},h}]);